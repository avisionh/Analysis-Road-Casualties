---
title: 'Analysis: Road Casualties - Camden'
author: "[Avision Ho](https://github.com/avisionh)"
date: "`r Sys.Date()`"
output: 
  html_document:
    number_sections: false
    theme: journal
    highlight: haddock
    code_folding: hide
    fig_caption: true
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(results = "asis", warning = FALSE, message = FALSE)

# Load packages
library(dplyr)
library(ggplot2)
library(pander)

# Turn off scientific notation
options(scipen = 999, expressions = 10000)

# Set theme for plots
plot_theme <- theme(plot.title = element_text(face = "bold", hjust = 0.5),
                    plot.subtitle = element_text(face = "bold", hjust = 0.5),
                    panel.background = element_blank(),
                    axis.line = element_line(color = "black"))

```

# Section 1: Executive Summary

# Section 2: Background

## Introduction
The purpose of this project is to explore the road casualty data publicly available for the London borough of Camden.

## Motivation
By exploring the data, we hope to identify and understand the following:

1. **Who** are most involved in road casualties

1. **What** types of casualties are most frequent, including their severity

1. **When** these casualties often occur 

1. **Where** road casualties take place

1. **How** these casualties take place, including weather conditions

The idea behind this exploratory analysis is to provide the platform for a classification model to be built to better understand who, what, when, where and how these casualties take place so more effective campaigns can be delivered by the local council to reduce casualties as well as identifying *hotspots* for where casualties most likely happen so that work such as building works to improve the roads, can be done by the council.

## Data
The data comes from the data.gov.uk website [here](https://data.gov.uk/dataset/f36669c1-fe1f-4cbc-803c-db49675247c3/road-collision-casualties-in-camden).

Note, as this is published to the public and from inspection, this data is already in a *tidy* format so little wrangling needs to be done.
```{r (HIDE) Data Preparation, echo = FALSE, include = FALSE}
source("scripts/0_data_wrangle.R")
source("scripts/3_4_analysis_where.R")
```

## Section 3: Analysis

### Who are most involved in road casualties?
We will begin by exploring the charateristics of those people who were involved in road casualties.

```{r (SHOW) Who are involved, echo = FALSE}
plot_base <- ggplot(data = data_casualty, mapping = aes(x = ModeOfTravel, fill = CasualtySex)) +
  labs(x = "Mode of Travel") +
  plot_theme +
  # add text-wrapping for x labels
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))
```

From the bar-chart below, we see that *men* are involved in casualties relating to *Powered 2-wheeler* whereas *women* are involved in casualties

```{r (SHOW) Who are involved - mode of travel, echo = FALSE}
plot_base +
  geom_bar(position = position_dodge()) +
  labs(title = "Bar-Chart: Count of Road Casualties", 
       subtitle = "by Mode of Travel and Sex",
       y = "Count of casualties")
```

Let's drill-down further as we have age related information in the dataset.

What we see in the box-plot is that for *fatal* casualties, they tend to be male who are younger than their female counterparts, on average. Yet the range of ages of male involved in a *fatal* road casualty is higher than their female counterparts - this is opposite to what we see in the *serious* road casualty severity.

```{r (SHOW) Who are involved - age, echo = FALSE}
ggplot(data = data_casualty, mapping = aes(x = CasualtySeverity, y = CasualtyAge, fill = CasualtySex)) +
  geom_boxplot() +
  labs(title = "Box-Plot: Severity of Casualty by Age",
       x = "Severity of Casualty",
       y = "Age of person involved in casualty") + 
  plot_theme
```

### What types of casualties are most frequent?
We will now investigate what types of casualties are most frequent so we can understand the actual end-product which impacts on casualties. For instance, if cars were the most likely cause behind the casualties, then would recommend avoiding driving in a public safety campaign.

From the table below, we see that for the *serious* and *fatal* severity casualties, the most frequent cases of these were from:

- Driver/Rider
- Pedestrian

```{r (SHOW) What types of casualties - table, echo = FALSE}
data_temp <- data_casualty %>% 
  group_by(CasualtySeverity, CasualtyClass) %>% 
  summarise(Total = n()) 

data_temp %>% 
  pander()
```

```{r (HIDE) What types of casualties - words, include = FALSE, echo = FALSE}
data_temp <- data_temp %>% 
  filter(CasualtyClass %in% c("1 Driver/Rider", "3 Pedestrian") & CasualtySeverity %in% c("1 Fatal", "2 Serious")) %>% 
  group_by(CasualtyClass) %>% 
  summarise(Total = sum(Total))

txt_driver <- data_temp %>% 
  filter(CasualtyClass == "1 Driver/Rider") %>% 
  select(Total) %>% 
  pull()
txt_pedestrian <- data_temp %>% 
  filter(CasualtyClass == "3 Pedestrian") %>% 
  select(Total) %>% 
  pull()

if (txt_driver > txt_pedestrian) {
  txt_compare <- "more"
} else if (txt_driver == txt_pedestrian) {
  txt_compare <- "same"
} else {
  txt_compare <- "less"
}
  
```

In total, there are `r toString(txt_driver)` *Driver/Rider* people who either experienced a *fatal* or *serious* casualty. This figure was `r toString(txt_pedestrian)` for *Pedestrian*s. Therefore, there were `r toString(txt_compare)` *Driver/Rider* *fatal*/*serious* casualties relative to *Pedestrians*.


### When do these casualties most frequently occur?
In this part, we will look at the times and days that these casualties take place so we can understand what days and times are most likely to yield a casualty and thereby allowing the emergency services in the council to respond approrpriately.

Looking at the plots below for each day, we learn that casulaties happen most likely around the periods:

- **Monday**: it's around rush hour going to work time,
- **Tuesday**: it's around rush hour going home time,
- **Wednesday**: it's around the same but more accidents overall compared to previous two days
- **Thursday** again around home time and less casualties than Wednesday
- **Friday**: around late evening as people go out to club and drink (possibly this is where expect most casualties overall
- **Saturday and Sunday**: is calmer, especially on Saturday morning as people nurse hangover.

```{r (SHOW) When do these casualties occur - time-series, echo = FALSE}
data_temp <- data_casualty %>% 
  filter(CasualtyClass %in% c("1 Driver/Rider", "3 Pedestrian") & CasualtySeverity %in% c("1 Fatal", "2 Serious")) 

ggplot(data = data_temp, mapping = aes(x = Time, colour = Day)) +
  geom_freqpoly(binwidth = 0.1, show.legend = FALSE) +
  facet_wrap(facets = vars(Day)) +
  labs(title = "Line-Chart: Casualties across Days and Time",
       x = "Time during the day",
       y = "Count of casualties") +
  plot_theme
```

### Where are these road casualties taking place?
In this section, will visualise where the road casualties take place in Camden so one can identify hotpots of casualties that may need thorough investigation into.

What we have below shows that down the centre of Camden, we have a higher concentration of casualties, suggesting more densely populated areas with drivers/riders and pedestrians.

```{r (SHOW) Where are road casualties occurring, echo = FALSE}
ggplot() + 
  geom_polygon(data = shape_camden_data, mapping = aes(x = long, y = lat, group = group, fill = id)) +
  geom_point(data = data_temp, mapping = aes(x = Longitude, y = Latitude)) +
  coord_fixed(1.3) +
  guides(fill = FALSE) +
  # tried to add text of location but doesn't exist
  #with(centroids, annotate(geom="text", x = long, y = lat, label=label, size=2)) +
  labs(title = "Location of casualties") +
  theme_bare
```

